#!/usr/sh
#
# makefile for fitpot
#

PMDDIR=../pmd
#-----------------------------------------------------------------------
# to be generated by configure script
#-----------------------------------------------------------------------
CPP= @CPP@
CPPFLAGS= @CPPFLAGS@
MPIFC= @FC@
MPIFLAGS= @FCFLAGS@ -I${PMDDIR}
#-----------------------------------------------------------------------
# suffixes
.SUFFIXES: .o .f .F .f90 .F90
.f.o: 
	${MPIFC} -c ${MPIFLAGS} $<
.F.o: 
	${MPIFC} -c ${MPIFLAGS} ${CPPFLAGS} $<
.f90.o: 
	${MPIFC} -c ${MPIFLAGS} $<
.F90.o: 
	${MPIFC} -c ${MPIFLAGS} ${CPPFLAGS} $<

fitpotobj= NN.o read_input.o fitpot.o
mods= mod_variables.o mod_parallel.o mod_minimize.o mod_random.o fp_common.o
args= iargc.o getarg.o

pmdobj= ${PMDDIR}/mod_pmdvars.o ${PMDDIR}/mod_pmdmpi.o ${PMDDIR}/mod_pmdio.o \
    ${PMDDIR}/mod_version.o ${PMDDIR}/mod_force.o ${PMDDIR}/mod_ttm.o \
    ${PMDDIR}/zload.o ${PMDDIR}/util_rnd.o ${PMDDIR}/util_tag.o \
    ${PMDDIR}/force_*.o ${PMDDIR}/sort.o ${PMDDIR}/mk_lspr.o \
    ${PMDDIR}/util_pmd.o ${PMDDIR}/lasubs.o ${PMDDIR}/util_vec.o \
    ${PMDDIR}/common_parallel.o ${PMDDIR}/pmd_core.o ${PMDDIR}/descriptor.o \
    ${PMDDIR}/metadynamics.o

${PMDDIR}/%.o: ${PMDDIR}/%.F90
	@[ -d ${PMDDIR} ]
	cd ${PMDDIR} && ${MPIFC} -c ${MPIFLAGS} -o $@ -c $<

${PMDDIR}/%.o: ${PMDDIR}/%.F
	@[ -d ${PMDDIR} ]
	cd ${PMDDIR} && ${MPIFC} -c ${MPIFLAGS} -o $@ -c $<

.PHONY: all clean
all: fitpot

clean:
	rm -f *.o *.mod *~ fitpot

fitpot: ${mods} ${fitpotobj} ${pmdobj}
	${MPIFC} ${MPIFLAGS} -o $@ ${mods} ${fitpotobj} ${pmdobj}

#.....Dependencies
read_input.o: ${mods}
fitpot.o: ${mods} NN.o
NN.o: ${mods}
mod_minimize.o: mod_random.o

fp_common.o fp_common.mod: fp_common.F90 mod_parallel.o mod_minimize.o
	${MPIFC} -c ${MPIFLAGS} ${CPPFLAGS} $<
